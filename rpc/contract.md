# RPC Contract â€” User Service

## Purpose
Defines a stable RPC contract between client and server.

---

## Transport
- Protocol: HTTP
- Payload: JSON
- Encoding: UTF-8
- Pattern: request / response
- State: stateless

---

## Versioning
- Version: v1
- Base path: /v1/rpc

---

## Endpoints

## GetUser

### Request
POST /v1/rpc/get_user

```json
{
  "id": 1
}
```

### Response
```json
{
  "id": 1,
  "firstname": "John",
  "lastname": "Doe",
  "email": "john@example.com",
  "created_at": "2025-01-01T12:00:00Z"
}
```

### Semantics
- Read-only
- No side effects
- Idempotent

---

## CreateUser

### Request
POST /v1/rpc/create_user

#### Headers
- Idempotency-Key: `<uuid>`

```json
{
  "id": 1,
  "firstname": "John",
  "lastname": "Doe",
  "email": "john@example.com"
}
```

### Response
```json
{
  "success": true
}
```

### Semantics
- Creates or overwrites a user with given `id`
- Logically idempotent
- Technically idempotent using Idempotency-Key

---

## Idempotency

### Definition
Repeated execution results in the same final state.

### Idempotency-Key
- Generated by client
- Unique per business operation
- Server stores key and result
- Duplicate requests return cached result

---

## Errors

### Error Format
```json
{
  "error": {
    "code": "USER_NOT_FOUND",
    "message": "User with given id does not exist"
  }
}
```

### Error Codes
- INVALID_REQUEST
- USER_NOT_FOUND
- CONFLICT
- TIMEOUT
- INTERNAL_ERROR

---

## Timeouts and Retries
- Client MUST set timeout
- Recommended timeout: 2 seconds
- Retry allowed only for:
  - idempotent operations
  - operations with Idempotency-Key

---

## Guarantees

### Server
- Deterministic behavior
- Contract compliance
- No session state

### Client
- Valid payloads
- Timeout handling
- Retry awareness

---

## Out of Scope
- Authentication
- Authorization
- Database schema
- Deployment
- Hostname / DNS

---

## Notes
- Contract is authoritative
- Implementation may change
- Breaking changes require version bump
